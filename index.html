<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Waileent | Premium Client</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>
  <style>
    :root {
      --dark-gray:#1a1a1a; --medium-gray:#2d2d2d; --light-gray:#3d3d3d;
      --accent-blue:#3498db; --text-white:#f5f5f5; --text-gray:#b3b3b3; --danger:#dc3545;
    }
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
    body{background-color:var(--dark-gray);color:var(--text-white);
      background-image:radial-gradient(circle at 15% 50%,rgba(52,152,219,.1) 0%,transparent 25%),
                       radial-gradient(circle at 85% 30%,rgba(52,152,219,.1) 0%,transparent 25%);
      min-height:100vh;overflow-x:hidden}
    html{scroll-behavior:smooth}
    /* Header */
    header{background-color:rgba(26,26,26,.95);backdrop-filter:blur(10px);padding:1rem 0;position:fixed;width:100%;top:0;z-index:1000;box-shadow:0 2px 15px rgba(0,0,0,.3);transition:all .3s ease}
    .header-container{display:flex;justify-content:space-between;align-items:center;max-width:1200px;margin:0 auto;padding:0 2rem}
    .logo{font-size:1.8rem;font-weight:700;color:var(--text-white);text-decoration:none;display:flex;align-items:center}
    .logo-highlight{color:var(--accent-blue);margin-left:.3rem}
    nav ul{display:flex;list-style:none}
    nav ul li{margin-left:1.5rem}
    nav ul li a{color:var(--text-white);text-decoration:none;font-weight:500;transition:all .3s ease;position:relative;padding:.5rem 0}
    nav ul li a:hover{color:var(--accent-blue)}
    nav ul li a::after{content:'';position:absolute;width:0;height:2px;background:var(--accent-blue);bottom:0;left:0;transition:width .3s ease}
    nav ul li a:hover::after{width:100%}
    .auth-buttons{display:flex;align-items:center}
    .auth-btn{padding:.5rem 1.2rem;border-radius:5px;text-decoration:none;font-weight:500;transition:all .3s ease;margin-left:1rem}
    .login-btn{color:var(--text-white);border:1px solid var(--accent-blue)}
    .login-btn:hover{background-color:rgba(52,152,219,.2)}
    .register-btn{background-color:var(--accent-blue);color:var(--dark-gray)}
    .register-btn:hover{background-color:#2980b9;transform:translateY(-2px);box-shadow:0 5px 15px rgba(52,152,219,.4)}
    /* Hero */
    .hero{padding:10rem 2rem 5rem;text-align:center;position:relative;overflow:hidden}
    .hero::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;
      background:radial-gradient(circle,rgba(52,152,219,.1) 0%,transparent 70%);z-index:-1;animation:pulse 15s infinite alternate}
    @keyframes pulse{0%{transform:scale(1)}100%{transform:scale(1.2)}}
    .hero h1{font-size:3.5rem;margin-bottom:1.5rem;background:linear-gradient(to right,var(--text-white),var(--accent-blue));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent}
    .hero p{font-size:1.2rem;color:var(--text-gray);max-width:700px;margin:0 auto 2.5rem;line-height:1.6}
    .cta-button{display:inline-block;padding:.8rem 2rem;background-color:var(--accent-blue);color:var(--dark-gray);
      text-decoration:none;border-radius:5px;font-weight:600;font-size:1.1rem;transition:all .3s ease;
      box-shadow:0 5px 15px rgba(52,152,219,.4)}
    .cta-button:hover{transform:translateY(-3px);box-shadow:0 8px 25px rgba(52,152,219,.5)}
    /* Sections */
    .features{padding:5rem 2rem;background-color:var(--medium-gray)}
    .section-title{text-align:center;margin-bottom:3rem;font-size:2.5rem}
    .features-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:2rem;max-width:1200px;margin:0 auto}
    .feature-card{background-color:var(--light-gray);border-radius:10px;padding:2rem;transition:all .3s ease;box-shadow:0 5px 15px rgba(0,0,0,.1)}
    .feature-card:hover{transform:translateY(-10px);box-shadow:0 15px 30px rgba(0,0,0,.2)}
    .feature-icon{font-size:2.5rem;color:var(--accent-blue);margin-bottom:1.5rem}
    .feature-title{font-size:1.5rem;margin-bottom:1rem}
    .feature-desc{color:var(--text-gray);line-height:1.6}
    .pricing{padding:5rem 2rem}
    .pricing-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:2rem;max-width:1200px;margin:0 auto}
    .pricing-card{background-color:var(--light-gray);border-radius:10px;padding:2rem;text-align:center;transition:all .3s ease;position:relative;overflow:hidden;box-shadow:0 5px 15px rgba(0,0,0,.1)}
    .pricing-card:hover{transform:translateY(-10px);box-shadow:0 15px 30px rgba(0,0,0,.2)}
    .pricing-title{font-size:1.5rem;margin-bottom:1rem}
    .pricing-price{font-size:2.5rem;font-weight:700;margin-bottom:1.5rem;color:var(--accent-blue)}
    .pricing-button{display:inline-block;padding:.7rem 1.5rem;background-color:var(--accent-blue);color:var(--dark-gray);
      text-decoration:none;border-radius:5px;font-weight:600;transition:all .3s ease}
    .pricing-button:hover{background-color:#2980b9;transform:translateY(-2px);box-shadow:0 5px 15px rgba(52,152,219,.4)}
    .services{padding:3rem 2rem;background-color:var(--medium-gray);text-align:center}
    .service-item{display:inline-block;margin:0 1rem 1.5rem;padding:1rem 2rem;background-color:var(--light-gray);border-radius:5px;font-weight:500}
    .service-price{color:var(--accent-blue);font-weight:600}
    footer{background-color:var(--dark-gray);padding:3rem 2rem;text-align:center}
    .footer-logo{font-size:1.8rem;font-weight:700;color:var(--text-white);margin-bottom:1.5rem;display:inline-block}
    .footer-logo span{color:var(--accent-blue)}
    .footer-links{display:flex;justify-content:center;list-style:none;margin-bottom:2rem;flex-wrap:wrap}
    .footer-links li{margin:0 1rem}
    .footer-links a{color:var(--text-gray);text-decoration:none;transition:color .3s ease}
    .footer-links a:hover{color:var(--accent-blue)}
    .copyright{color:var(--text-gray);font-size:.9rem}
    /* Modal */
    .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.8);z-index:2000;justify-content:center;align-items:center}
    .modal-content{background-color:var(--light-gray);border-radius:10px;width:90%;max-width:500px;padding:2rem;position:relative;animation:modalFadeIn .3s ease}
    @keyframes modalFadeIn{from{opacity:0;transform:translateY(-50px)}to{opacity:1;transform:translateY(0)}}
    .close-modal{position:absolute;top:1rem;right:1rem;font-size:1.5rem;cursor:pointer;color:var(--text-gray);transition:color .3s ease}
    .close-modal:hover{color:var(--text-white)}
    .modal-title{font-size:1.8rem;margin-bottom:1.5rem;text-align:center;color:var(--accent-blue)}
    .form-group{margin-bottom:1.2rem}
    .form-group label{display:block;margin-bottom:.5rem;font-weight:500}
    .form-control{width:100%;padding:.8rem;border-radius:5px;border:1px solid rgba(255,255,255,.2);background-color:var(--medium-gray);color:var(--text-white);font-size:1rem}
    .form-control:focus{outline:none;border-color:var(--accent-blue)}
    .submit-btn{width:100%;padding:.8rem;background-color:var(--accent-blue);color:var(--dark-gray);border:none;border-radius:5px;font-weight:600;font-size:1rem;cursor:pointer;transition:all .3s ease}
    .submit-btn:hover{background-color:#2980b9}
    .toast{position:fixed;top:20px;right:20px;background-color:var(--accent-blue);color:var(--dark-gray);
      padding:10px 20px;border-radius:5px;z-index:3000;display:none}
    /* Dashboard (hidden until auth) */
    #dashboard{display:none;padding:8rem 2rem;max-width:1200px;margin:0 auto}
    .dashboard-grid{display:grid;grid-template-columns:1fr;gap:1.5rem}
    .dashboard-card{background-color:var(--light-gray);border-radius:10px;padding:2rem;box-shadow:0 5px 15px rgba(0,0,0,.1)}
    .logout-btn{background:var(--danger);color:#fff;border:none;border-radius:6px;padding:.6rem 1rem;cursor:pointer}
    .logout-btn:hover{filter:brightness(.95)}
    .muted{color:var(--text-gray)}
    .row{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:1rem}
    .row > div{background:rgba(255,255,255,.03);padding:.75rem;border-radius:8px}
    @media (max-width:768px){.header-container{flex-direction:column;padding:1rem}nav ul{margin:1rem 0}
      nav ul li{margin-left:1rem}.auth-buttons{margin-top:1rem}.hero h1{font-size:2.5rem}.hero p{font-size:1rem}
      .row{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Header -->
  <header id="header">
    <div class="header-container">
      <a href="#" class="logo">Waileent<span class="logo-highlight">.</span></a>
      <nav>
        <ul>
          <li><a href="#features">Возможности</a></li>
          <li><a href="#pricing">Цены</a></li>
          <li><a href="#services">Дополнительно</a></li>
          <li><a href="#dashboard" id="dashboard-link" style="display:none;">Кабинет</a></li>
        </ul>
      </nav>
      <div class="auth-buttons" id="auth-buttons">
        <a href="#login-modal" class="auth-btn login-btn" id="login-btn">Вход</a>
        <a href="#register-modal" class="auth-btn register-btn" id="register-btn">Регистрация</a>
      </div>
      <div class="auth-buttons" id="logout-wrap" style="display:none;">
        <button class="logout-btn" id="logout-btn"><i class="fas fa-sign-out-alt"></i>&nbsp;Выйти</button>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero" id="hero">
    <h1 class="animate__animated animate__fadeInDown">Waileent Client</h1>
    <p class="animate__animated animate__fadeIn animate__delay-1s">Премиум клиент с красивым дизайном, оптимизацией, частыми обновлениями и лучшей поддержкой.</p>
    <a href="#pricing" class="cta-button animate__animated animate__fadeIn animate__delay-2s">Купить сейчас</a>
  </section>

  <!-- Features -->
  <section class="features" id="features">
    <h2 class="section-title animate__animated animate__fadeIn">Наши преимущества</h2>
    <div class="features-grid">
      <div class="feature-card animate__animated animate__fadeInUp">
        <div class="feature-icon"><i class="fas fa-paint-brush"></i></div>
        <h3 class="feature-title">Красивый внешний вид</h3>
        <p class="feature-desc">Настройте оформление клиента под себя с яркими визуальными функциями.</p>
      </div>
      <div class="feature-card animate__animated animate__fadeInUp animate__delay-1s">
        <div class="feature-icon"><i class="fas fa-tachometer-alt"></i></div>
        <h3 class="feature-title">Оптимизация</h3>
        <p class="feature-desc">Клиент работает даже на слабых компьютерах благодаря нашей оптимизации.</p>
      </div>
      <div class="feature-card animate__animated animate__fadeInUp animate__delay-2s">
        <div class="feature-icon"><i class="fas fa-sync"></i></div>
        <h3 class="feature-title">Частые обновления</h3>
        <p class="feature-desc">Регулярные обновления с новыми функциями и улучшениями.</p>
      </div>
      <div class="feature-card animate__animated animate__fadeInUp animate__delay-3s">
        <div class="feature-icon"><i class="fas fa-headset"></i></div>
        <h3 class="feature-title">Поддержка</h3>
        <p class="feature-desc">Быстрая и надежная поддержка для решения любых вопросов.</p>
      </div>
    </div>
  </section>

  <!-- Pricing -->
  <section class="pricing" id="pricing">
    <h2 class="section-title animate__animated animate__fadeIn">Наши тарифы</h2>
    <div class="pricing-grid">
      <div class="pricing-card animate__animated animate__fadeInLeft">
        <h3 class="pricing-title">1 Месяц</h3>
        <div class="pricing-price">60₽</div>
        <a href="https://funpay.com/users/13118271/" target="_blank" class="pricing-button">Купить через FunPay</a>
      </div>
      <div class="pricing-card popular animate__animated animate__fadeInUp">
        <h3 class="pricing-title">3 Месяца</h3>
        <div class="pricing-price">120₽</div>
        <a href="https://funpay.com/users/13118271/" target="_blank" class="pricing-button">Купить через FunPay</a>
      </div>
      <div class="pricing-card animate__animated animate__fadeInRight">
        <h3 class="pricing-title">1 Год</h3>
        <div class="pricing-price">140₽</div>
        <a href="https://funpay.com/users/13118271/" target="_blank" class="pricing-button">Купить через FunPay</a>
      </div>
      <div class="pricing-card animate__animated animate__fadeInRight animate__delay-1s">
        <h3 class="pricing-title">Навсегда</h3>
        <div class="pricing-price">206₽</div>
        <a href="https://funpay.com/users/13118271/" target="_blank" class="pricing-button">Купить через FunPay</a>
      </div>
    </div>
  </section>

  <!-- Services -->
  <section class="services" id="services">
    <h2 class="section-title animate__animated animate__fadeIn">Дополнительные услуги</h2>
    <div class="animate__animated animate__fadeInUp">
      <div class="service-item">
        Сброс HWID: <span class="service-price">200₽</span>
        <a href="https://funpay.com/users/13118271/" target="_blank" class="pricing-button mt-2">Купить через FunPay</a>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <a href="#" class="footer-logo">Waileent<span>.</span></a>
    <ul class="footer-links">
      <li><a href="#features">Возможности</a></li>
      <li><a href="#pricing">Цены</a></li>
      <li><a href="#services">Дополнительно</a></li>
      <li><a href="#login-modal">Вход</a></li>
      <li><a href="#register-modal">Регистрация</a></li>
    </ul>
    <p class="copyright">© 2025 Waileent Client. Все права защищены.</p>
  </footer>

  <!-- Login Modal -->
  <div class="modal" id="login-modal" aria-hidden="true">
    <div class="modal-content">
      <span class="close-modal" data-close="login-modal">&times;</span>
      <h2 class="modal-title">Вход в аккаунт</h2>
      <form id="login-form" action="login.php" method="post">
        <div class="form-group">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" name="email" class="form-control" required autocomplete="email">
        </div>
        <div class="form-group">
          <label for="login-password">Пароль</label>
          <input type="password" id="login-password" name="password" class="form-control" required autocomplete="current-password">
        </div>
        <button type="submit" class="submit-btn">Войти</button>
        <div class="form-footer" style="text-align:center;margin-top:1rem;color:var(--text-gray)">
          Нет аккаунта? <a href="#register-modal" class="switch-to-register">Зарегистрироваться</a>
        </div>
      </form>
    </div>
  </div>

  <!-- Register Modal -->
  <div class="modal" id="register-modal" aria-hidden="true">
    <div class="modal-content">
      <span class="close-modal" data-close="register-modal">&times;</span>
      <h2 class="modal-title">Регистрация</h2>
      <form id="register-form" action="register.php" method="post">
        <div class="form-group">
          <label for="reg-username">Логин</label>
          <input type="text" id="reg-username" name="username" class="form-control" required autocomplete="username">
        </div>
        <div class="form-group">
          <label for="reg-email">Email</label>
          <input type="email" id="reg-email" name="email" class="form-control" required autocomplete="email">
        </div>
        <div class="form-group">
          <label for="reg-password">Пароль</label>
          <input type="password" id="reg-password" name="password" class="form-control" required autocomplete="new-password" minlength="6">
        </div>
        <button type="submit" class="submit-btn">Зарегистрироваться</button>
        <div class="form-footer" style="text-align:center;margin-top:1rem;color:var(--text-gray)">
          Уже есть аккаунт? <a href="#login-modal" class="switch-to-login">Войти</a>
        </div>
      </form>
    </div>
  </div>

  <!-- DASHBOARD (внизу страницы, скрыт до регистрации/входа) -->
  <section id="dashboard" aria-live="polite">
    <h2 class="section-title animate__animated animate__fadeIn">Личный кабинет</h2>

    <div class="dashboard-grid">
      <!-- Профиль -->
      <div class="dashboard-card animate__animated animate__fadeInUp">
        <h3><i class="fas fa-user-circle"></i> Профиль</h3>
        <div class="row" style="margin-top:1rem">
          <div><b>UID:</b> <span id="u-id" class="muted">—</span></div>
          <div><b>Логин:</b> <span id="u-name" class="muted">—</span></div>
          <div><b>Email:</b> <span id="u-mail" class="muted">—</span></div>
          <div><b>HWID:</b> <span id="u-hwid" class="muted">—</span></div>
          <div style="grid-column:1 / -1"><b>Статус ключа:</b> <span id="u-keystatus" class="muted">Не активирован</span></div>
        </div>
      </div>

      <!-- Активация ключа -->
      <div class="dashboard-card animate__animated animate__fadeInUp">
        <h3><i class="fas fa-key"></i> Активация</h3>
        <form id="key-form" action="activate_key.php" method="post" style="margin-top:1rem">
          <div class="form-group">
            <label for="key">Ключ активации</label>
            <input type="text" id="key" name="key" class="form-control" placeholder="XXXX-XXXX-XXXX-XXXX" required>
          </div>
          <button type="submit" class="submit-btn">Активировать</button>
        </form>
      </div>

      <!-- Скачивание лоадера -->
      <div class="dashboard-card animate__animated animate__fadeInUp">
        <h3><i class="fas fa-download"></i> Скачивание лоадера</h3>
        <p class="muted" style="margin:.5rem 0 1rem">Нажмите кнопку ниже, чтобы скачать последнюю версию лоадера.</p>
        <!-- ЗАМЕНИ на свой прямой Dropbox dl=1 -->
        <a id="loader-link" href="https://www.dropbox.com/s/your_file_id/loader.zip?dl=1" class="pricing-button" download>
          Скачать лоадер (.zip)
        </a>
      </div>

      <!-- АДМИН-ПАНЕЛЬ (показывается только is_admin=true) -->
      <div class="dashboard-card animate__animated animate__fadeInUp" id="admin-panel" style="display:none;">
        <h3><i class="fas fa-tools"></i> Админ‑панель</h3>

        <form id="gen-key-form" action="generate_key.php" method="post" style="margin-top:1rem">
          <label for="key_type">Тип ключа</label>
          <select id="key_type" name="key_type" class="form-control" required>
            <option value="1month">1 Месяц</option>
            <option value="3months">3 Месяца</option>
            <option value="1year">1 Год</option>
            <option value="forever">Навсегда</option>
            <option value="hwid_reset">Сброс HWID</option>
          </select>
          <button type="submit" class="submit-btn" style="margin-top:.6rem">Сгенерировать ключ</button>
        </form>

        <hr style="border:none;height:1px;background:rgba(255,255,255,.08);margin:1.2rem 0"/>

        <form id="gen-promo-form" action="generate_promocode.php" method="post">
          <label for="promocode">Промокод</label>
          <input type="text" id="promocode" name="promocode" class="form-control" placeholder="PROMO2025" required>
          <label for="discount" style="margin-top:.6rem">Скидка, %</label>
          <input type="number" id="discount" name="discount" class="form-control" min="1" max="100" value="10" required>
          <button type="submit" class="submit-btn" style="margin-top:.6rem">Создать промокод</button>
        </form>
      </div>
    </div>
  </section>

  <!-- Scripts -->
  <script>
    // ---------- utils ----------
    const $ = sel => document.querySelector(sel);
    const show = el => el.style.display = 'block';
    const hide = el => el.style.display = 'none';
    function showToast(message, color){
      const toast = $('#toast'); toast.textContent = message;
      toast.style.backgroundColor = color || 'var(--accent-blue)';
      toast.style.display = 'block'; setTimeout(()=>toast.style.display='none', 3000);
    }
    function toggleAuthUI(isAuth){
      if(isAuth){ hide($('#auth-buttons')); show($('#logout-wrap')); show($('#dashboard-link')); }
      else{ show($('#auth-buttons')); hide($('#logout-wrap')); hide($('#dashboard-link')); }
    }
    function openDashboard(){
      hide($('#hero'));
      show($('#dashboard'));
      window.location.hash = '#dashboard';
    }
    function closeAllModals(){ document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); document.body.style.overflow='auto'; }

    // ---------- Modal logic ----------
    $('#login-btn').addEventListener('click', (e)=>{e.preventDefault(); $('#login-modal').style.display='flex'; document.body.style.overflow='hidden';});
    $('#register-btn').addEventListener('click', (e)=>{e.preventDefault(); $('#register-modal').style.display='flex'; document.body.style.overflow='hidden';});
    document.querySelectorAll('.close-modal').forEach(btn=>{
      btn.addEventListener('click', ()=>{ closeAllModals(); });
    });
    document.addEventListener('click', (e)=>{
      if(e.target.classList.contains('modal')) closeAllModals();
    });
    document.querySelectorAll('.switch-to-register').forEach(a=>{
      a.addEventListener('click',(e)=>{e.preventDefault(); closeAllModals(); $('#register-modal').style.display='flex'; document.body.style.overflow='hidden';});
    });
    document.querySelectorAll('.switch-to-login').forEach(a=>{
      a.addEventListener('click',(e)=>{e.preventDefault(); closeAllModals(); $('#login-modal').style.display='flex'; document.body.style.overflow='hidden';});
    });

    // ---------- State ----------
    let currentUser = null; // {id, username, email, hwid, key_status, is_admin}

    function fillDashboard(u){
      $('#u-id').textContent = u.id ?? '—';
      $('#u-name').textContent = u.username ?? '—';
      $('#u-mail').textContent = u.email ?? '—';
      $('#u-hwid').textContent = u.hwid ?? '—';
      $('#u-keystatus').textContent = u.key_status ?? 'Не активирован';
      if(u.is_admin){ show($('#admin-panel')); } else { hide($('#admin-panel')); }
    }

    // ---------- Auth: Register ----------
    $('#register-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      try{
        const res = await fetch(e.target.action, { method:'POST', body: fd });
        const json = await res.json();
        showToast(json.message || 'Ок', json.color || '#34d399');
        if(json.success){
          currentUser = json.user || currentUser; // ожидаем user из ответа
          toggleAuthUI(true);
          closeAllModals();
          openDashboard();
          if(currentUser) fillDashboard(currentUser);
        }
      }catch(err){ showToast('Ошибка регистрации', '#ef4444'); }
    });

    // ---------- Auth: Login ----------
    $('#login-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      try{
        const res = await fetch(e.target.action, { method:'POST', body: fd });
        const json = await res.json();
        showToast(json.message || 'Ок', json.color || '#34d399');
        if(json.success){
          currentUser = json.user || currentUser;
          toggleAuthUI(true);
          closeAllModals();
          openDashboard();
          if(currentUser) fillDashboard(currentUser);
        }
      }catch(err){ showToast('Ошибка входа', '#ef4444'); }
    });

    // ---------- Logout (простой редирект на logout.php, который чистит сессию) ----------
    $('#logout-btn').addEventListener('click', async ()=>{
      try{ await fetch('logout.php', { method:'POST' }); }catch(e){}
      currentUser=null; toggleAuthUI(false); window.location.hash='#'; location.reload();
    });

    // ---------- Key activate ----------
    $('#key-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      try{
        const res = await fetch(e.target.action, { method:'POST', body: fd });
        const json = await res.json();
        showToast(json.message || 'Готово', json.color || '#34d399');
        if(json.success){
          // обновляем статус ключа
          if(json.key_status) $('#u-keystatus').textContent = json.key_status;
          else $('#u-keystatus').textContent = 'Активирован';
        }
      }catch(err){ showToast('Ошибка активации', '#ef4444'); }
    });

    // ---------- Admin: generate key / promo ----------
    $('#gen-key-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      try{
        const res = await fetch(e.target.action, { method:'POST', body: fd });
        const json = await res.json();
        showToast(json.message || 'Ключ сгенерирован', json.color || '#34d399');
      }catch(err){ showToast('Ошибка генерации ключа', '#ef4444'); }
    });

    $('#gen-promo-form').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      try{
        const res = await fetch(e.target.action, { method:'POST', body: fd });
        const json = await res.json();
        showToast(json.message || 'Промокод создан', json.color || '#34d399');
      }catch(err){ showToast('Ошибка создания промокода', '#ef4444'); }
    });

    // ---------- Header scroll effect ----------
    window.addEventListener('scroll', ()=>{
      const header = document.getElementById('header');
      if(window.scrollY > 50) header.classList.add('scrolled'); else header.classList.remove('scrolled');
    });

    // ---------- Optional: если хочешь автологин по существующей сессии ----------
    // Раскомментируй и сделай эндпойнт profile.php, который отдаёт { success:true, user:{...} }
    /*
    (async ()=>{
      try{
        const res = await fetch('profile.php');
        const j = await res.json();
        if(j.success && j.user){
          currentUser = j.user;
          toggleAuthUI(true);
          openDashboard();
          fillDashboard(currentUser);
        }
      }catch(e){}
    })();
    */
  </script>
</body>
</html>
